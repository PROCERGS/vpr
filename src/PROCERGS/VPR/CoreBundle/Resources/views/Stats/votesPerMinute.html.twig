{% extends '::base.html.twig' %}

{% block header %}

{% endblock %}

{% block body %}
    <script type="text/javascript" src="https://www.google.com/jsapi?autoload={'modules':[{'name':'visualization','version':'1.1','packages':['bar']}]}"></script>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <div id="top_x_div" style="width: 100%; height: 90vh;"></div>

    <script>
        google.setOnLoadCallback(updateChart);

        function drawStuff(chartData) {
            var data = new google.visualization.arrayToDataTable(chartData);

            var options = {
                title: 'Votos por Minuto',
                width: '100%',
                legend: {position: 'none'},
                chart: {subtitle: 'Consulta Popular 2015'},
                bar: {groupWidth: "90%"}
            };

            var chart = new google.charts.Bar(document.getElementById('top_x_div'));
            chart.draw(data, google.charts.Bar.convertOptions(options));
        }
        ;

        function updateChart() {
            $.getJSON('{{ path('vpr_stats_vpm_data') }}', function (rawData) {
                var chartData = [
                    ['Time', 'Votes']
                ];
                for (var index = 0; index < rawData.length; ++index) {
                    var time = rawData[index].time;
                    var votes = rawData[index].votes;
                    chartData.push([new Date(time), votes]);
                }
                drawStuff(chartData);

                setTimeout(function () {
                    updateChart();
                }, 20000);
            });
        }
        ;
    </script>
{% endblock %}
