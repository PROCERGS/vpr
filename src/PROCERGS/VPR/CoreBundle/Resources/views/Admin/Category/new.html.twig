{% extends 'PROCERGSVPRCoreBundle::base.admin.html.twig' %}
{% set contentName = 'admin.category' | trans %}
{% set actionName = 'admin.add' | trans %}

{% block content -%}
    <div class="navbar">
        <a class="btn btn-default" href="{{ path('admin_category') }}" role="button"><span class="glyphicon glyphicon-arrow-left"></span> {% trans %}admin.back_to_list{% endtrans %}</a>
    </div>

    {{ form_start(form, {'attr': {'role':'form', 'class':'form-horizontal', 'id': 'form-category'}}) }}
        {{ form_errors(form) }}

        <div class="form-group">
            <label class="col-sm-2 control-label">{% trans %}admin.name{% endtrans %}</label>
            <div class="col-sm-10">
                {{ form_errors(form.name) }}
                {{ form_widget(form.name, {'attr': {'class': 'form-control cat-name'}}) }}
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">{% trans %}admin.sorting{% endtrans%}</label>
            <div class="col-sm-1">
                {{ form_errors(form.sorting) }}
                {{ form_widget(form.sorting, {'attr': {'class': 'form-control'}}) }}
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">{% trans %}admin.title.bg{% endtrans %}</label>
            <div class="col-sm-2 col-input">
                {{ form_errors(form.titleBg) }}
                {{ form_widget(form.titleBg, {'attr': {'class': 'form-control colorHex'}}) }}
            </div>
            <div class="col-sm-2">
                <div class="colorSelector" data-type="title"><div class="bg" style="background-color: {{ form.vars.data.titleBg}}"></div></div>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">{% trans %}admin.icon.bg{% endtrans %}</label>
            <div class="col-sm-2 col-input">
                {{ form_errors(form.iconBg) }}
                {{ form_widget(form.iconBg, {'attr': {'class': 'form-control colorHex icon-color'}}) }}
            </div>
            <div class="col-sm-2">
                <div class="colorSelector" data-type="icon"><div class="bg" style="background-color: {{ form.vars.data.iconBg}}"></div></div>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">{% trans %}admin.icon.img{% endtrans %}</label>
            <div class="col-sm-2 col-input">
                {{ form_errors(form.iconNum) }}
                {{ form_widget(form.iconNum, {'attr': {'class': 'form-control colorHex icon-select'}}) }}
            </div>
            <div class="col-sm-2">
                <div class="category-preview">
                    <div class="pre-icon-1"><span class="icon"><i class="img"></i></span></div>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">{% trans %}admin.option.bg{% endtrans %}</label>
            <div class="col-sm-2 col-input">
                {{ form_errors(form.optionBg) }}
                {{ form_widget(form.optionBg, {'attr': {'class': 'form-control colorHex'}}) }}
            </div>
            <div class="col-sm-2">
                <div class="colorSelector" data-type="option"><div class="bg" style="background-color: {{ form.vars.data.optionBg}}"></div></div>
            </div>
        </div>

        <div class="form-group form-actions">
            <div class="col-lg-10 col-lg-offset-2">
                {{ form_widget(form.submit, {'attr': {'class': 'btn btn-success btn-sm btn-save'},'label':'admin.save'|trans}) }}
            </div>
        </div>

    {{ form_end(form) }}

    <h3>Preview</h3>
    <div class="category-preview" style="margin: 10px 0 20px;">
        <div class="bg">
            <div class="pre-icon-1"><span class="icon"><i class="img"></i></span></div>
            <span class="name"></span>

        </div>
    </div>
</ul>
{% endblock %}

{% block stylesheets %}
{{ parent() }}
{% stylesheets 'bundles/procergsvprcore/css/colorpicker.css' filter='cssrewrite' %}
<link rel="stylesheet" href="{{ asset_url }}" />
{% endstylesheets %}
{% endblock %}

{% block javascripts %}
{{ parent() }}
{% javascripts '@PROCERGSVPRCoreBundle/Resources/public/js/colorpicker.js' %}
<script type="text/javascript" src="{{ asset_url }}"></script>
{% endjavascripts %}
<script type="text/javascript">
    $(function() {
        $('.colorSelector').ColorPicker({
            onChange: function (hsb, hex, rgb) {
                var el = this.data('colorpicker').el;
                $(el).find('.bg').css('backgroundColor', '#' + hex);
                $(el).parent().prev('.col-input').find(".colorHex").val("#" + hex);

                var type = $(el).data("type");
                switch (type) {
                    case 'title':
                        $(".category-preview .bg").css("background-color", '#' + hex);
                        break;
                    case 'icon':
                        $(".category-preview .icon").css("background-color", '#' + hex);
                        break;
                    case 'option':
                        // $(".category-preview .icon").css("background-color", '#' + hex);
                        break;
                }
            }
        });

        $(".cat-name").on("input", function() {
            var name = $(this).val();
            $(".category-preview .name").text(name);
        });

        $(".icon-select").on("change", function() {
            console.log($('.colorSelector').ColorPicker());

            var val = $(this).val();
            $(".category-preview").removeClass (function (index, css) {
                return (css.match (/(^|\s)pre-icon-\S+/g) || []).join(' ');
            }).addClass("pre-icon-" + val);
        })
    })
</script>
{% endblock %}